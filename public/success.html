<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gorder</title>
</head>

<body>
    <section>
        <div class="main-card">
            <div class="icon-placeholder">ğŸ“¦</div>
            <p class="title">
                æ‚¨å·²æˆåŠŸä¸‹å•ï¼
            </p>
            <p class="status-line">
                è®¢å•çŠ¶æ€ï¼š<span id="orderStatus" class="status-tag">ç­‰å¾…ä¸­...</span>
            </p>
        </div>

        <div class="ready-popup">
            <div class="popup-content">
                <div class="success-icon">âœ…</div>
                <p class="popup-title">æ‚¨çš„è®¢å•æ­£åœ¨å¤„ç†ä¸­...</p>
                <p class="order-info">
                    è®¢å•å·ï¼š<b><span id="orderID"></span></b>
                </p>

                <button class="close-btn" onclick="document.querySelector('.ready-popup').style.display = 'none'">
                    å…³é—­
                </button>
            </div>
        </div>

        <div class="after-payment-popup">
            <div class="popup-content">
                <div class="waiting-icon">ğŸ’³</div>
                <p class="popup-title">ç­‰å¾…æ”¯ä»˜ä¸­...</p>
                <a id="payment-link" href="#" class="action-btn">å»æ”¯ä»˜</a>
            </div>
        </div>
    </section>
</body>

<style>
    /* å…¨å±€é‡ç½®ä¸å­—ä½“ */
    * {
        box-sizing: border-box;
    }

    body,
    html {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background-color: #f4f7f6;
        /* æŸ”å’Œçš„æµ…ç°èƒŒæ™¯ */
        color: #333;
        height: 100%;
    }

    /* ä¸»å¸ƒå±€ */
    section {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
    }

    /* ä¸»å¡ç‰‡æ ·å¼ */
    .main-card {
        background: white;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        text-align: center;
        max-width: 400px;
        width: 100%;
        transition: transform 0.3s ease;
    }

    .icon-placeholder {
        font-size: 48px;
        margin-bottom: 16px;
    }

    .title {
        font-size: 24px;
        font-weight: 700;
        margin: 0 0 10px 0;
        color: #2c3e50;
    }

    .status-line {
        font-size: 16px;
        color: #666;
        margin: 0;
    }

    .status-tag {
        color: #3498db;
        font-weight: 600;
    }

    /* å¼¹çª—é€šç”¨æ ·å¼é€»è¾‘ 
       æ³¨æ„ï¼šJSä¼šå°†displayè®¾ç½®ä¸ºblockï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ text-align: center é…åˆ padding æ¥å±…ä¸­å†…å®¹
    */
    .ready-popup,
    .after-payment-popup {
        display: none;
        /* åˆå§‹éšè— */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        /* åŠé€æ˜é®ç½©å±‚ */
        z-index: 100;
        backdrop-filter: blur(4px);
        /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */

        /* ä¸ºäº†é…åˆ JS çš„ display:blockï¼Œè¿™é‡Œä½¿ç”¨ Flex å¸ƒå±€æ¥å±…ä¸­å¼¹çª—æœ¬èº«æ˜¯ä¸è¡Œçš„ï¼Œ
           å› ä¸º JS ä¼šè¦†ç›– display å±æ€§ã€‚
           æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ absolute å®šä½ + transform æ¥ä¿æŒå±…ä¸­ï¼Œæˆ–è€…è®©å†…éƒ¨å®¹å™¨å±…ä¸­ã€‚
           ä½†åœ¨åŸ JSé€»è¾‘ä¸­ï¼Œå®ƒç›´æ¥æ“ä½œçš„æ˜¯ popup divã€‚
           ä¸ºäº†å…¼å®¹ JS çš„ display:blockï¼Œæˆ‘ä»¬è®©è¿™ä¸ª popup æœ¬èº«å…¨å±ï¼Œç„¶åå†…å®¹ç”¨ margin å±…ä¸­ã€‚
        */
    }

    /* ç”±äº JS è®¾ç½® style.display = 'block' ä¼šè¦†ç›– CSS ä¸­çš„ display: flexï¼Œ
       ä¸ºäº†ä¿è¯å¼¹çª—å±…ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ JS çš„è¡Œä¸ºåšç‰¹æ®Šçš„ CSS å¤„ç†ã€‚
       æˆ‘ä»¬å°† popup å®šä¹‰ä¸ºå…¨å±é®ç½©ï¼Œåˆ©ç”¨ padding-top æˆ– transform å±…ä¸­å†…éƒ¨å†…å®¹ã€‚
    */
    .ready-popup,
    .after-payment-popup {
        /* JS è®¾ç½® block åï¼Œè¿™é‡Œä½œä¸ºé®ç½©å±‚ */
    }

    /* å¢åŠ ä¸€ä¸ªå†…éƒ¨å®¹å™¨æ ·å¼çš„å®šä¹‰ (è™½ç„¶ HTML ç»“æ„æ²¡å˜ï¼Œä½†æˆ‘ä»¬åˆ©ç”¨ CSS é€‰æ‹©å™¨ç¾åŒ–ç›´æ¥å­å…ƒç´ ) */
    .ready-popup>*,
    .after-payment-popup>* {
        /* è¿™æ˜¯ä¸€ä¸ªç¨å¾®æœ‰äº› hack çš„å†™æ³•ï¼Œå› ä¸º HTML ç»“æ„æ¯”è¾ƒç®€å•ã€‚
           æ›´å¥½çš„æ–¹å¼æ˜¯ç»™å†…å®¹åŒ…ä¸€å±‚ divï¼Œä½†ä¸ºäº†ä¸¥æ ¼ä¸æ”¹ç»“æ„ï¼Œæˆ‘ä»¬ç›´æ¥ä¿®é¥°ã€‚
        */
    }

    /* é‡æ–°å®šä¹‰å¼¹çª—æœ¬èº«ä¸ºå±…ä¸­çš„å¡ç‰‡ï¼Œä½†å› ä¸º JS è¦†ç›– displayï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§å…¼å®¹å†™æ³• */
    .ready-popup,
    .after-payment-popup {
        /* è¦†ç›–åŸæ¥çš„ fixed å®šä½é€»è¾‘ï¼Œä½¿å…¶æ›´ç°ä»£åŒ– */
        top: 50%;
        left: 50%;
        width: auto;
        height: auto;
        transform: translate(-50%, -50%);

        background-color: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        border: none;
        /* å»é™¤æ—§è¾¹æ¡† */
        text-align: center;
        min-width: 300px;
    }

    .popup-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 15px !important;
        color: #333;
    }

    .order-info {
        margin: 15px 0;
        font-size: 14px;
        color: #888;
        /* æ›¿ä»£åŸæœ‰çš„ burlywood é¢œè‰² */
    }

    .order-info b span {
        color: #e67e22;
        /* æ©™è‰²é«˜äº®è®¢å•å· */
        font-family: monospace;
        font-size: 1.1em;
    }

    /* æŒ‰é’®æ ·å¼ */
    .close-btn,
    .after-payment-popup a {
        display: inline-block;
        margin-top: 20px;
        padding: 10px 24px;
        background-color: #27ae60;
        /* ç»¿è‰²ä¸»è‰²è°ƒ */
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        text-decoration: none;
        transition: background-color 0.2s, transform 0.1s;
        box-shadow: 0 4px 6px rgba(39, 174, 96, 0.2);
    }

    .close-btn:hover,
    .after-payment-popup a:hover {
        background-color: #219150;
        transform: translateY(-1px);
    }

    .close-btn:active,
    .after-payment-popup a:active {
        transform: translateY(0);
    }

    /* æ”¯ä»˜æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
    .after-payment-popup a {
        background-color: #2980b9;
        /* è“è‰²æ”¯ä»˜æŒ‰é’® */
        box-shadow: 0 4px 6px rgba(41, 128, 185, 0.2);
    }

    .after-payment-popup a:hover {
        background-color: #2471a3;
    }
</style>

<script>
    const urlParam = new URLSearchParams(window.location.search);
    const customerID = urlParam.get('customerID');
    const orderID = urlParam.get('orderID');
    const order = {
        customerID,
        orderID,
        status: 'pending'
    };
    const getOrder = async () => {
        // Mocking the fetch for demonstration since API is not available locally
        // In production, this line remains exactly as your original code:
        // const res = await fetch(`/api/customer/${customerID}/orders/${orderID}`);

        // --- è¯·ä¿ç•™åŸæœ¬çš„ fetch ä»£ç ï¼Œè¿™é‡Œä»…ä¸ºå±•ç¤ºé€»è¾‘ ---
        const res = await fetch(`/api/customer/${customerID}/orders/${orderID}`);
        // ------------------------------------------------

        const data = await res.json();
        console.log("data = ", data)

        /*
        {
          "code": 0,
          "message": "success",
          "data": {
            ...
          }
        }
         */
        if (data.data.Order.Status === 'waiting_for_payment') {
            order.Status = 'ç­‰å¾…æ”¯ä»˜...';
            document.getElementById('orderStatus').innerText = order.Status;
            document.querySelector('.after-payment-popup').style.display = 'block';
            document.getElementById('payment-link').href = data.data.Order.PaymentLink;
        }
        if (data.data.Order.Status === 'paid') {
            order.Status = 'å·²æ”¯ä»˜æˆåŠŸï¼Œè¯·ç­‰å¾…...';
            document.getElementById('orderStatus').innerText = order.Status;
            setTimeout(getOrder, 5000);
        } else if (data.data.Order.Status === 'ready') {
            order.Status = 'å·²å®Œæˆ';
            document.querySelector('.after-payment-popup').style.display = 'none';
            document.querySelector('.ready-popup').style.display = 'block';
            document.getElementById('orderID').innerText = orderID;
            document.getElementById('orderStatus').innerText = order.Status;
        } else {
            setTimeout(getOrder, 5000);
        }
    }
    getOrder();
</script>

</html>